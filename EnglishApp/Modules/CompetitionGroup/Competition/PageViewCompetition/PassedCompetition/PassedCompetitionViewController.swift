//
//  PassedCompetitionViewController.swift
//  EnglishApp
//
//  Created Steve on 12/10/19.
//  Copyright © 2019 demo. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit
import XLPagerTabStrip

class PassedCompetitionViewController: ListManagerVC {

    var presenter: PassedCompetitionPresenterProtocol?
    var date: String = ""

    override func setUpViews() {
        showButtonBack = false
        super.setUpViews()
        NotificationCenter.default.addObserver(self, selector: #selector(logout), name: NSNotification.Name.init("LogoutSuccessed"), object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(login), name: NSNotification.Name.init("UserDidLogin"), object: nil)
    }
    
    @objc func login() {
       self.offset = 0
       callAPI()
    }
       
    @objc func logout() {
       self.offset = 0
       callAPI()
    }
    
    override func registerTableView() {
        super.registerTableView()
        self.tableView.registerXibFile(CompetitionCell.self)
        self.tableView.contentInset = UIEdgeInsets(top: 0, left: 0, bottom: 50, right: 0)
    }
    
    override func callAPI() {
        super.callAPI()
        self.presenter?.getListFight(offset: self.offset)
    }
    
    override func cellForRowListManager(item: Any, _ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let data = listData[indexPath.row] as! CompetitionEntity
        let cell = self.tableView.dequeue(CompetitionCell.self, for: indexPath)
        cell.index = indexPath.row
        cell.setupCellDone(competitionEntity: data)
        cell.actionFight = {[weak self](index) in
            guard let self = self else {return}
            self.actionFight(index: index)
        }
        return cell
    }
    
    func actionFight(index: Int) {
        let data = listData[index] as! CompetitionEntity
        let vc = ResultGroupRouter.createModule(idCompetition: String(data.id ?? 0), idExercise: data.exercise_id ?? "0", isHistory: true, endDate: Date())
        vc.hidesBottomBarWhenPushed = true
        self.push(controller: vc)
    }
    
    override func didSelectTableView(item: Any, indexPath: IndexPath) {
        actionFight(index: indexPath.row)
    }
}

extension PassedCompetitionViewController : PassedCompetitionViewProtocol {
    func didGetList(competitionList: CollectionCompetitionEntity) {
        self.initLoadData(data: competitionList.competitionEntity ?? [])
    }
}

extension PassedCompetitionViewController: IndicatorInfoProvider{
    func indicatorInfo(for pagerTabStripController: PagerTabStripViewController) -> IndicatorInfo {
        return IndicatorInfo(title: LocalizableKey.passed.showLanguage)
    }
}

