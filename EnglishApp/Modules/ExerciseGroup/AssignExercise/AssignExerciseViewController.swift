//
//  AssignExerciseViewController.swift
//  EnglishApp
//
//  Created Steve on 7/18/19.
//  Copyright © 2019 demo. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit

class AssignExerciseViewController: BaseViewController {

	var presenter: AssignExercisePresenterProtocol?
    
    @IBOutlet weak var tbvAssignExercise: UITableView!

    
    var offset: Int = 0
    
    override func setUpViews() {
        super.setUpViews()
        tbvAssignExercise.registerXibFile(CellAssignExercise.self)
        tbvAssignExercise.dataSource = self
        tbvAssignExercise.delegate = self
        self.presenter?.getListAssignExercise(offset: self.offset)

    }
    override func setUpNavigation() {
        super.setUpNavigation()
        self.tabBarController?.tabBar.isHidden = true
        addBackToNavigation()
        setTitleNavigation(title: LocalizableKey.assign_exercise.showLanguage)
    }
    
}

extension AssignExerciseViewController : AssignExerciseViewProtocol{
    func reloadView() {
        tbvAssignExercise.reloadData()
    }
}

extension AssignExerciseViewController : UITableViewDataSource{
    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return self.presenter?.listAssignExercise?.exercises?.count ?? 0
    }
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeue(CellAssignExercise.self, for: indexPath)
        cell.indexPath = indexPath
        if let dataCell = self.presenter?.listAssignExercise?.exercises?[indexPath.row]{
            cell.setupCell(dataCell: dataCell)
        }
        return cell
    }
    func tableView(_ tableView: UITableView, willDisplay cell: UITableViewCell, forRowAt indexPath: IndexPath) {
        let row = self.presenter?.listAssignExercise?.exercises?.count ?? 0
        if indexPath.row == row {
            self.offset += limit
            self.presenter?.getListAssignExercise(offset: self.offset)
        }
    }
}
extension AssignExerciseViewController : UITableViewDelegate{
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        if let id = self.presenter?.listAssignExercise?.exercises?[indexPath.row]._id {
            let vc = NameExerciseRouter.createModule(id: id, type: .assignExercise)
            self.push(controller: vc)
        }
    }
    
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return UITableView.automaticDimension
    }
    func tableView(_ tableView: UITableView, estimatedHeightForRowAt indexPath: IndexPath) -> CGFloat {
        return 60
    }
}
