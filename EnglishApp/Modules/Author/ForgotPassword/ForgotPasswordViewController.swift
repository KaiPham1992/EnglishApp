//
//  ForgotPasswordViewController.swift
//  EnglishApp
//
//  Created Kai Pham on 5/11/19.
//  Copyright © 2019 demo. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit

class ForgotPasswordViewController: BaseViewController {

	var presenter: ForgotPasswordPresenterProtocol?
    @IBOutlet weak var btnSendEmail: UIButton!
    @IBOutlet weak var lbMessage: UILabel!
    @IBOutlet weak var vEmail: AppTextField!
    @IBOutlet weak var lbError: UILabel!

	override func viewDidLoad() {
        super.viewDidLoad()
    }
    
    override func setUpNavigation() {
        super.setUpNavigation()
        
        addBackToNavigation()
    }
    
    
    override func setTitleUI() {
        super.setTitleUI()
        setColorStatusBar()
        setTitleNavigation(title: LocalizableKey.ForgotTitle.showLanguage)
        btnSendEmail.setTitle(LocalizableKey.SentEmail.showLanguage.uppercased(), for: .normal)
        lbMessage.text = LocalizableKey.ForgotPasswordMessage.showLanguage
         vEmail.setTitleAndPlaceHolder(title: LocalizableKey.LoginEmail.showLanguage, placeHolder: LocalizableKey.LoginEmailPlaceHolder.showLanguage)
    }
    
    @IBAction func btnSendEmailTapped() {
        if validateInputData() {
            presenter?.forgotPassword(email: vEmail.getText())
        }
    }
}

extension ForgotPasswordViewController {
    func validateInputData() -> Bool {
        if self.vEmail.tfInput.text == "" {
            hideError(isHidden: false, message: LocalizableKey.pleaseEnterEmail.showLanguage)
            return false
        }
        
        if let email = self.vEmail.tfInput.text, email.isValidEmail() == false {
            hideError(isHidden: false, message:  LocalizableKey.invalidLoginEmail.showLanguage)
            return false
        }
        
        hideError()
        return true
    }
    
    func hideError(isHidden: Bool = true, message: String? = nil){
        lbError.isHidden = isHidden
        lbError.text = message ?? ""
    }
}

extension ForgotPasswordViewController: ForgotPasswordViewProtocol {
    func didForgotPassword(data: BaseResponse?) {
        PopUpHelper.shared.sentNewPassword {
            self.pop()
        }
    }
    
    func didForgotPassword(error: APIError?) {
        hideError(isHidden: false, message: error?.message&.showLanguage)
    }
}
